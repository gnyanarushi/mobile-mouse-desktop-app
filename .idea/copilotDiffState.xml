<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/CURSOR_MOVEMENT_IMPLEMENTATION.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/CURSOR_MOVEMENT_IMPLEMENTATION.md" />
              <option name="updatedContent" value="# Cursor Movement Implementation - xdotool Support&#10;&#10;## Summary of Changes&#10;&#10;The application has been updated to support **actual system cursor movement** on Linux using `xdotool`, while maintaining fallback support for Java's Robot class on all platforms.&#10;&#10;## What Was the Problem?&#10;&#10;Java's `Robot` class requires elevated privileges (sudo) on Linux to move the actual system cursor due to security restrictions. The user's cursor was not moving because:&#10;&#10;1. Without `sudo`, Robot class cannot access the input devices&#10;2. Running with `sudo` is inconvenient and not ideal for a GUI application&#10;3. Different desktop environments (X11, Wayland) have different permission models&#10;&#10;## The Solution&#10;&#10;### **xdotool** - A Better Way&#10;&#10;We now use `xdotool` (a command-line X11 automation tool) which:&#10;- ✅ Works WITHOUT sudo&#10;- ✅ Works with both X11 and Wayland&#10;- ✅ Automatically detected and used if available&#10;- ✅ Gracefully falls back to Robot if not available&#10;&#10;## How It Works&#10;&#10;The `MouseController` class now:&#10;&#10;1. **On startup**, checks if running on Linux and if `xdotool` is available&#10;2. **Sets a flag** (`useXdotool`) based on availability&#10;3. **For cursor movement**, uses the appropriate method:&#10;   - `xdotool mousemove X Y` if available&#10;   - `Robot.mouseMove()` as fallback&#10;4. **For clicks**, uses:&#10;   - `xdotool click [1/3]` if available (1=left, 3=right)&#10;   - `Robot.mousePress/Release` as fallback&#10;&#10;## Code Changes&#10;&#10;### MouseController.java&#10;&#10;**New fields:**&#10;```java&#10;private boolean useXdotool = false;&#10;private static final String OS_NAME = System.getProperty(&quot;os.name&quot;).toLowerCase();&#10;private static final boolean IS_LINUX = OS_NAME.contains(&quot;linux&quot;);&#10;```&#10;&#10;**New methods:**&#10;- `checkXdotoolAvailable()` - Checks if xdotool command is available&#10;- `moveToAbsolute(int x, int y)` - Moves cursor using xdotool or Robot&#10;&#10;**Updated methods:**&#10;- `moveBy()` - Now uses `moveToAbsolute()` instead of direct `Robot.mouseMove()`&#10;- `leftClick()` - Now uses xdotool or Robot&#10;- `rightClick()` - Now uses xdotool or Robot&#10;&#10;## Installation&#10;&#10;### Quick Start (Ubuntu/Debian)&#10;```bash&#10;sudo apt-get update&#10;sudo apt-get install xdotool&#10;```&#10;&#10;### Verify&#10;```bash&#10;which xdotool&#10;```&#10;&#10;### Run Application&#10;```bash&#10;./gradlew run&#10;# No sudo needed!&#10;```&#10;&#10;For other Linux distributions and troubleshooting, see **XDOTOOL_SETUP.md**&#10;&#10;## Logging Output&#10;&#10;When you run the application, you'll see:&#10;&#10;**With xdotool installed:**&#10;```&#10;✓ xdotool found - using xdotool for cursor movement&#10;✓ Cursor movement working successfully!&#10;Moving cursor: (X, Y) -&gt; (X+dx, Y+dy) [delta: dx, dy]&#10;✓ Cursor moved successfully to: (X, Y)&#10;```&#10;&#10;**Without xdotool (fallback):**&#10;```&#10;⚠ xdotool not found - trying Robot (may not work without sudo)&#10;```&#10;&#10;## Backward Compatibility&#10;&#10;- **Other platforms** (Windows, macOS): Automatically uses Robot class&#10;- **Linux without xdotool**: Falls back to Robot class (same as before)&#10;- **No code changes needed in other classes**: The change is completely transparent&#10;&#10;## Testing&#10;&#10;To test if cursor movement is working:&#10;&#10;1. Install xdotool: `sudo apt-get install xdotool`&#10;2. Run the app: `./gradlew run`&#10;3. Connect from Flutter mobile app&#10;4. Tilt the device and watch the dashboard&#10;5. **The actual laptop cursor should move!**&#10;&#10;## FAQ&#10;&#10;**Q: Do I need to run with sudo?**&#10;A: No! That's the whole point. xdotool works without sudo.&#10;&#10;**Q: Will this work on Wayland?**&#10;A: Yes, xdotool works on modern Wayland too (GNOME 40+).&#10;&#10;**Q: What if xdotool is not available?**&#10;A: The app automatically falls back to Java's Robot class (with its limitations).&#10;&#10;**Q: Can I force using Robot instead of xdotool?**&#10;A: Not currently, but you can modify the `useXdotool` flag in the constructor if needed.&#10;&#10;## Files Modified&#10;&#10;- `src/main/java/com/mousecontrol/controller/MouseController.java` - Main implementation&#10;&#10;## Files Created&#10;&#10;- `XDOTOOL_SETUP.md` - Detailed setup and troubleshooting guide&#10;- This file: `CURSOR_MOVEMENT_IMPLEMENTATION.md`&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/FIX_CURSOR_LINUX.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/FIX_CURSOR_LINUX.md" />
              <option name="updatedContent" value="# Fix: Cursor Not Moving on Linux&#10;&#10;## The Problem&#10;Your application shows:&#10;- ✅ Gyro data is received (dashboard shows values)&#10;- ✅ Calculations work (movement pixels calculated)&#10;- ✅ Logical cursor position updates (MouseInfo reports new position)&#10;- ❌ **ACTUAL SCREEN CURSOR DOES NOT MOVE**&#10;&#10;This is a **Linux permissions/display server issue** with Java's Robot class.&#10;&#10;---&#10;&#10;## Solution 1: Run with sudo (Quick Fix)&#10;&#10;The Robot class needs elevated privileges to control the cursor on Linux.&#10;&#10;```bash&#10;# Build the application&#10;./gradlew clean build&#10;&#10;# Run with sudo&#10;sudo java -cp build/libs/mobile-mouse-desktop-app-all.jar com.mousecontrol.Main&#10;```&#10;&#10;Or with Gradle:&#10;```bash&#10;sudo ./gradlew run&#10;```&#10;&#10;---&#10;&#10;## Solution 2: Add User to Input Group (Permanent Fix)&#10;&#10;Instead of using sudo every time, add your user to the `input` group:&#10;&#10;```bash&#10;# Add current user to input group&#10;sudo usermod -a -G input $USER&#10;&#10;# Verify group was added&#10;groups $USER&#10;&#10;# IMPORTANT: Logout and login again for changes to take effect&#10;# Or reboot your system&#10;```&#10;&#10;After logout/login, run normally:&#10;```bash&#10;./gradlew run&#10;```&#10;&#10;---&#10;&#10;## Solution 3: X11 Permissions (Alternative)&#10;&#10;If you're using X11, grant permission:&#10;&#10;```bash&#10;# Allow localhost to connect to X server&#10;xhost +local:&#10;&#10;# Run the application&#10;./gradlew run&#10;&#10;# Later, you can revoke (for security)&#10;xhost -local:&#10;```&#10;&#10;---&#10;&#10;## Solution 4: Check Display Server Type&#10;&#10;### For X11 (Most Common)&#10;```bash&#10;echo $XDG_SESSION_TYPE&#10;# Should output: x11&#10;&#10;# Make sure DISPLAY is set&#10;echo $DISPLAY&#10;# Should output something like: :0 or :1&#10;```&#10;&#10;### For Wayland (Newer Systems)&#10;Wayland has stricter security. You may need to:&#10;&#10;```bash&#10;# Switch to X11 session (at login screen)&#10;# OR force XWayland compatibility&#10;export GDK_BACKEND=x11&#10;&#10;# Then run the app&#10;./gradlew run&#10;```&#10;&#10;---&#10;&#10;## Solution 5: Verify Robot Works&#10;&#10;The application now includes a **startup test** that verifies if Robot can move the cursor.&#10;&#10;When you run the app, look for this output:&#10;&#10;```&#10;✓ Robot initialized successfully&#10;Current cursor position: 1024, 768&#10;✓ Robot can move cursor successfully!&#10;```&#10;&#10;If you see:&#10;```&#10;⚠ WARNING: Robot.mouseMove() not working!&#10;  This may be a permissions issue on Linux.&#10;```&#10;&#10;Then one of the above solutions is needed.&#10;&#10;---&#10;&#10;## Diagnostic Commands&#10;&#10;### Check Current Permissions&#10;```bash&#10;# Show current user groups&#10;groups&#10;&#10;# Show input device permissions&#10;ls -la /dev/input/&#10;```&#10;&#10;### Check Display Server&#10;```bash&#10;# What display server are you using?&#10;echo $XDG_SESSION_TYPE&#10;&#10;# X11 display&#10;echo $DISPLAY&#10;&#10;# Wayland display&#10;echo $WAYLAND_DISPLAY&#10;```&#10;&#10;### Test Java Robot Manually&#10;Create a simple test:&#10;```java&#10;import java.awt.*;&#10;&#10;public class TestRobot {&#10;    public static void main(String[] args) throws Exception {&#10;        Robot robot = new Robot();&#10;        Point before = MouseInfo.getPointerInfo().getLocation();&#10;        System.out.println(&quot;Before: &quot; + before);&#10;        &#10;        robot.mouseMove(500, 500);&#10;        Thread.sleep(100);&#10;        &#10;        Point after = MouseInfo.getPointerInfo().getLocation();&#10;        System.out.println(&quot;After: &quot; + after);&#10;        &#10;        if (after.x == 500 &amp;&amp; after.y == 500) {&#10;            System.out.println(&quot;✓ Robot works!&quot;);&#10;        } else {&#10;            System.out.println(&quot;✗ Robot NOT working - need permissions&quot;);&#10;        }&#10;    }&#10;}&#10;```&#10;&#10;Compile and run:&#10;```bash&#10;javac TestRobot.java&#10;java TestRobot&#10;```&#10;&#10;---&#10;&#10;## Why This Happens&#10;&#10;On Linux, the Java `Robot` class uses:&#10;- **X11**: XTest extension to move cursor&#10;- **Wayland**: More restricted, may not work at all&#10;&#10;The system requires special permissions to:&#10;1. Read input devices (`/dev/input/*`)&#10;2. Inject mouse events to the display server&#10;3. Control cursor position globally&#10;&#10;Without proper permissions:&#10;- `robot.mouseMove(x, y)` executes without error&#10;- But the actual cursor doesn't move&#10;- `MouseInfo.getPointerInfo()` may return the &quot;intended&quot; position (not actual)&#10;&#10;---&#10;&#10;## Verification Steps&#10;&#10;After applying a solution:&#10;&#10;1. **Run the application**&#10;   ```bash&#10;   ./gradlew run&#10;   # or&#10;   sudo ./gradlew run&#10;   ```&#10;&#10;2. **Check startup output**&#10;   ```&#10;   ✓ Robot initialized successfully&#10;   ✓ Robot can move cursor successfully!&#10;   ```&#10;&#10;3. **Connect Flutter app** - Dashboard shows &quot;Connected&quot;&#10;&#10;4. **Tilt phone** - Watch for:&#10;   ```&#10;   Moving cursor: (1024, 768) -&gt; (1049, 756) [delta: 25, -12]&#10;   ✓ Cursor moved successfully to: (1049, 756)&#10;   ```&#10;&#10;5. **Watch actual screen cursor** - Should move in response to phone tilt!&#10;&#10;---&#10;&#10;## Still Not Working?&#10;&#10;### If using Wayland:&#10;Wayland has strict security - Robot may not work at all. Solutions:&#10;1. Switch to X11 session (at login screen, select X11 instead of Wayland)&#10;2. Use XWayland compatibility layer&#10;3. Consider using a different approach (xdotool, wmctrl)&#10;&#10;### Alternative: Use xdotool (Linux native tool)&#10;```bash&#10;# Install xdotool&#10;sudo apt-get install xdotool   # Ubuntu/Debian&#10;sudo dnf install xdotool       # Fedora&#10;sudo pacman -S xdotool         # Arch&#10;&#10;# Test cursor movement&#10;xdotool mousemove 500 500&#10;```&#10;&#10;Then modify the Java app to use ProcessBuilder to call xdotool instead of Robot.&#10;&#10;---&#10;&#10;## Recommended Approach&#10;&#10;**For Development/Testing:**&#10;```bash&#10;sudo ./gradlew run&#10;```&#10;&#10;**For Production:**&#10;```bash&#10;# One-time setup&#10;sudo usermod -a -G input $USER&#10;# Logout and login&#10;&#10;# Then run normally&#10;./gradlew run&#10;```&#10;&#10;---&#10;&#10;## Summary&#10;&#10;The cursor not moving is **NOT** a bug in your code - it's a **Linux security feature**.&#10;&#10;✅ Your application logic is correct  &#10;✅ Gyro data reception works  &#10;✅ Movement calculations work  &#10;✅ Robot API calls are correct  &#10;❌ Robot needs elevated privileges on Linux  &#10;&#10;**Quick Fix:** Run with `sudo ./gradlew run`  &#10;**Permanent Fix:** Add user to `input` group and logout/login&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/XDOTOOL_SETUP.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/XDOTOOL_SETUP.md" />
              <option name="updatedContent" value="# xdotool Setup Guide&#10;&#10;## Why xdotool?&#10;&#10;The application now supports **xdotool** for actual cursor movement on Linux systems. This is a much better alternative to Java's `Robot` class because:&#10;&#10;- ✅ **No sudo required** - Works without elevated privileges&#10;- ✅ **Works on Wayland and X11** - Better compatibility&#10;- ✅ **More reliable** - Less prone to permission issues&#10;- ✅ **Fallback support** - If xdotool isn't available, it will fall back to Robot class&#10;&#10;## Installation&#10;&#10;### Ubuntu/Debian&#10;```bash&#10;sudo apt-get update&#10;sudo apt-get install xdotool&#10;```&#10;&#10;### Fedora&#10;```bash&#10;sudo dnf install xdotool&#10;```&#10;&#10;### Arch&#10;```bash&#10;sudo pacman -S xdotool&#10;```&#10;&#10;### Verify Installation&#10;```bash&#10;which xdotool&#10;xdotool --version&#10;```&#10;&#10;## How It Works&#10;&#10;The application automatically:&#10;1. Detects if running on Linux&#10;2. Checks if `xdotool` is available&#10;3. Uses `xdotool` if available for cursor movement&#10;4. Falls back to Java `Robot` class if xdotool is not available&#10;&#10;## Running the Application&#10;&#10;After installing xdotool, simply run:&#10;&#10;```bash&#10;./gradlew run&#10;```&#10;&#10;**No sudo needed!**&#10;&#10;## Testing&#10;&#10;Once the app is running, you should see in the console:&#10;```&#10;✓ xdotool found - using xdotool for cursor movement&#10;✓ Cursor movement working successfully!&#10;```&#10;&#10;If you see:&#10;```&#10;⚠ xdotool not found - trying Robot (may not work without sudo)&#10;```&#10;&#10;Then install xdotool as shown above.&#10;&#10;## Troubleshooting&#10;&#10;### Still not working on Wayland?&#10;Some Wayland desktops (like GNOME 42+) may have additional restrictions. Try:&#10;&#10;```bash&#10;# Check your session type&#10;echo $XDG_SESSION_TYPE&#10;```&#10;&#10;If it says `wayland`, you may need to:&#10;- Enable xdotool in your Wayland settings, or&#10;- Switch to X11 session&#10;&#10;### Test xdotool directly&#10;```bash&#10;# Move cursor to position (100, 100)&#10;xdotool mousemove 100 100&#10;&#10;# Click mouse button 1 (left click)&#10;xdotool click 1&#10;```&#10;&#10;If these work, the application should work too!&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>